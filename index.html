<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cruise Official</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root {
  --primary:#2481cc; --bg:#000; --panel:#0a0a0a; --border:#1a1a1a; 
  --text-dim:#888; --gold:#f39c12;
}

/* Base */
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;outline:none;}
body,html{margin:0;padding:0;width:100%;height:100%;background:var(--bg);color:#fff;font-family:-apple-system,sans-serif;overflow:hidden;}

/* Navbar */
.navbar{display:flex;justify-content:space-between;align-items:center;padding:0 20px;height:65px;background:#000;border-bottom:1px solid var(--border);position:fixed;top:0;width:100%;z-index:1000;}
.logo{font-weight:900;letter-spacing:5px;font-size:20px;color:#fff;}
.live-tag{font-size:10px;color:#00ff00;font-weight:bold;border:1px solid #00ff0044;padding:2px 8px;border-radius:10px;}

/* Main Views */
.main-view{margin-top:65px;height:calc(100vh - 65px);overflow-y:auto;width:100%;}
.view{display:none;padding:15px;}
.view.active{display:block;}

/* Post Cards */
.post{background:var(--panel);border:1px solid var(--border);border-radius:20px;padding:20px;margin-bottom:15px;position:relative;}
.post-top{display:flex;justify-content:space-between;margin-bottom:10px;}
.u-name{font-weight:800;color:var(--primary);font-size:14px;}
.del-btn{background:none;border:none;color:#ff4444;font-size:18px;}

/* Profile Cards */
.card-stat{background:linear-gradient(145deg,#111,#000);border:1px solid var(--border);border-radius:20px;padding:25px;text-align:center;margin-bottom:20px;}
.balance{font-size:32px;font-weight:900;color:var(--gold);margin:10px 0;}
.task-item{display:flex;justify-content:space-between;align-items:center;padding:15px;background:#111;border-radius:15px;margin-bottom:10px;border:1px solid var(--border);}

/* Floating + Button */
#cruise-fab{
  position:fixed;bottom:25px;right:20px;width:58px;height:58px;
  background: linear-gradient(135deg,#2d0b59,#5a189a,#9d4edd,#c77dff);
  border-radius:14px;transform:rotate(45deg);
  display:flex;align-items:center;justify-content:center;z-index:9999;
  box-shadow:0 0 12px rgba(157,78,221,0.9),0 0 25px rgba(90,24,154,0.6);
  animation:cruisePulse 2.5s infinite; cursor:pointer;
}
#cruise-fab span{transform:rotate(-45deg);font-size:32px;font-weight:bold;color:#fff;}
@keyframes cruisePulse{
  0%{box-shadow:0 0 10px rgba(157,78,221,.6),0 0 20px rgba(90,24,154,.4);}
  50%{box-shadow:0 0 18px rgba(199,125,255,.9),0 0 35px rgba(90,24,154,.8);}
  100%{box-shadow:0 0 10px rgba(157,78,221,.6),0 0 20px rgba(90,24,154,.4);}
}
#cruise-fab:active{transform:rotate(45deg) scale(0.9);}

/* Slide-Up Post Menu */
#post-menu{position:fixed;inset:0;display:none;z-index:10000;}
#post-menu .menu-bg{position:absolute;inset:0;background:rgba(0,0,0,0.6);}
#post-menu .menu-content{
  position:absolute;bottom:-100%;left:0;width:100%;background:#111;
  border-top-left-radius:20px;border-top-right-radius:20px;
  display:flex;flex-direction:column;padding:20px;gap:12px;transition:bottom 0.35s ease-out;
}
#post-menu.active .menu-content{bottom:0;}
.menu-btn{
  background: linear-gradient(135deg,#4B1C7D,#5A189A);color:#fff;border:none;padding:15px;border-radius:14px;font-size:18px;font-weight:bold;cursor:pointer;
}
.cancel-btn{background:#444;}

/* Post Screen */
#post-screen{position:fixed;inset:0;display:none;z-index:10001;}
#post-screen .screen-bg{position:absolute;inset:0;background:rgba(0,0,0,0.7);}
#post-screen .screen-content{
  position:absolute;bottom:-100%;left:0;width:100%;background:#111;
  border-top-left-radius:20px;border-top-right-radius:20px;
  padding:20px;display:flex;flex-direction:column;gap:12px;
  transition:bottom 0.35s ease-out;max-height:85%;overflow-y:auto;
}
#media-preview{width:100%;height:220px;background:#222;border-radius:16px;display:flex;align-items:center;justify-content:center;color:#888;font-size:18px;}
#post-caption{width:100%;background:#111;border:1px solid #444;border-radius:12px;padding:12px;color:#fff;font-size:16px;resize:none;}
.post-actions{display:flex;justify-content:space-between;align-items:center;}
.post-actions button{background:linear-gradient(135deg,#4B1C7D,#5A189A);color:#fff;border:none;padding:10px 20px;border-radius:12px;font-weight:bold;cursor:pointer;}
#emoji-panel,#gif-panel{display:none;max-height:150px;overflow-y:auto;margin-top:10px;background:#1a0a2a;border-radius:12px;padding:10px;gap:8px;display:flex;flex-wrap:wrap;}

/* Hidden file inputs */
#file-input,#gif-input{display:none;}
</style>
</head>
<body>

<nav class="navbar">
  <div class="logo">CRUISE</div>
  <div class="live-tag">‚óè LIVE</div>
</nav>

<div class="main-view">
  <div id="v-home" class="view active"><div id="feed"></div></div>
  <div id="v-wallet" class="view">
    <div class="card-stat">
      <div style="font-size:12px;color:var(--text-dim);">TOTAL EARNINGS</div>
      <div class="balance">1,250 <span style="font-size:14px;">CRZ</span></div>
      <button style="background:var(--primary);color:#fff;border:none;padding:8px 20px;border-radius:10px;font-weight:bold;">Withdraw</button>
    </div>
    <h3 style="margin-left:5px;">Daily Tasks</h3>
    <div class="task-item"><span>Daily Check-in</span><b style="color:var(--gold);">+10</b></div>
    <div class="task-item"><span>Watch 5 Shorts</span><b style="color:var(--gold);">+50</b></div>
    <div class="task-item"><span>Post a Cruise</span><b style="color:var(--gold);">+20</b></div>
  </div>
  <div id="v-profile" class="view">
    <div style="text-align:center;padding:20px;">
      <div id="pfp" style="width:90px;height:90px;background:var(--primary);border-radius:25px;margin:0 auto 15px;display:flex;align-items:center;justify-content:center;font-size:35px;font-weight:bold;">?</div>
      <h2 id="u-display" style="margin:0;">User</h2>
      <p style="color:var(--text-dim);margin-top:5px;">@cruiser_global</p>
      <div style="display:flex;justify-content:center;gap:30px;margin-top:20px;">
        <div><b id="post-count">0</b><br><small style="color:var(--text-dim);">Posts</small></div>
        <div><b>12k</b><br><small style="color:var(--text-dim);">Fans</small></div>
      </div>
    </div>
  </div>
</div>

<!-- Floating + Button -->
<div id="cruise-fab"><span>+</span></div>

<!-- Slide-Up Post Menu -->
<div id="post-menu">
  <div class="menu-bg" onclick="closePostMenu()"></div>
  <div class="menu-content">
    <button class="menu-btn" onclick="openCamera()">üì∑ Camera</button>
    <button class="menu-btn" onclick="openGallery()">üñºÔ∏è Gallery</button>
    <button class="menu-btn" onclick="openVideo()">üé¨ Video</button>
    <button class="menu-btn" onclick="openGif()">üéûÔ∏è GIF</button>
    <button class="menu-btn" onclick="openArticle()">‚úçÔ∏è Article</button>
    <button class="menu-btn cancel-btn" onclick="closePostMenu()">‚ùå Cancel</button>
  </div>
</div>

<!-- Post Screen -->
<div id="post-screen">
  <div class="screen-bg" onclick="closePostScreen()"></div>
  <div class="screen-content">
    <div id="media-preview">Preview</div>
    <textarea id="post-caption" placeholder="What's the vibe?"></textarea>
    <div class="post-actions">
      <button id="emoji-btn">üòä</button>
      <button id="gif-btn">üéûÔ∏è GIF</button>
      <button id="post-btn">POST</button>
    </div>
    <div id="emoji-panel"></div>
    <div id="gif-panel"></div>
  </div>
</div>

<!-- Hidden file inputs -->
<input type="file" id="file-input" accept="image/*,video/*">
<input type="file" id="gif-input" accept="image/gif">

<script>
const tg = window.Telegram.WebApp;
tg.expand();
const SB_URL = "https://chsybopznpfdvhmdspox.supabase.co"; 
const SB_KEY = "sb_publishable_IfqycsZxpWeXgSPA5U7D5w_u-nl_FJf";
const sb = supabase.createClient(SB_URL, SB_KEY);

const myName = tg.initDataUnsafe?.user?.first_name || "Guest";
document.getElementById('u-display').innerText = myName;
document.getElementById('pfp').innerText = myName[0];

// Load feed
async function load() {
  const { data, error } = await sb.from('posts').select('*').order('created_at',{ascending:false});
  if(!error){
    document.getElementById('post-count').innerText = data.filter(p=>p.username===myName).length;
    document.getElementById('feed').innerHTML = data.map(p=>`
      <div class="post">
        <div class="post-top">
          <span class="u-name">@${p.username.toLowerCase()}</span>
          ${p.username===myName?`<button class="del-btn" onclick="del('${p.id}')">‚úï</button>`:''}
        </div>
        <div style="font-size:17px;line-height:1.5;">${p.content}</div>
        ${p.media_url?`<div style="margin-top:10px;">${p.media_url.endsWith('.mp4')?`<video controls style="max-width:100%;border-radius:12px;"><source src="${sb.storage.from('posts-media').getPublicUrl(p.media_url).data.publicUrl}" type="video/mp4"></video>`:`<img src="${sb.storage.from('posts-media').getPublicUrl(p.media_url).data.publicUrl}" style="max-width:100%;border-radius:12px;">`}</div>`:''}
      </div>
    `).join('');
  }
}

// Delete post
async function del(id){
  tg.showConfirm("Delete this post permanently?", async ok=>{
    if(ok){
      await sb.from('posts').delete().eq('id',id);
      load();
    }
  });
}

// Navigation
function go(v,b){
  document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
  document.getElementById('v-'+v).classList.add('active');
  load();
}

// + Button & Menu
document.getElementById("cruise-fab").onclick=()=>{tg.HapticFeedback.impactOccurred("medium");openPostMenu();}
function openPostMenu(){const menu=document.getElementById("post-menu");menu.style.display="block";setTimeout(()=>menu.classList.add("active"),50);}
function closePostMenu(){const menu=document.getElementById("post-menu");menu.classList.remove("active");setTimeout(()=>menu.style.display="none",350);}

// Post screen
function openPostScreen(previewType){document.getElementById("post-screen").style.display="block";setTimeout(()=>document.getElementById("post-screen").classList.add("active"),50);document.getElementById("media-preview").innerText=previewType;}
function closePostScreen(){const screen=document.getElementById("post-screen");screen.classList.remove("active");setTimeout(()=>screen.style.display="none",350);}

// Media Upload
function openCamera(){openFilePicker('camera');}
function openGallery(){openFilePicker('gallery');}
function openVideo(){openFilePicker('video');}

function openFilePicker(type){
  const fileInput = document.getElementById("file-input");
  if(type==='video') fileInput.accept="video/*";
  else fileInput.accept="image/*";
  fileInput.click();
  fileInput.onchange = async (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const preview = document.getElementById("media-preview");
    if(file.type.startsWith("image")){
      const reader = new FileReader();
      reader.onload = ()=> preview.innerHTML = `<img src="${reader.result}" style="max-width:100%;max-height:220px;border-radius:12px;">`;
      reader.readAsDataURL(file);
    } else if(file.type.startsWith("video")){
      const url = URL.createObjectURL(file);
      preview.innerHTML = `<video controls style="max-width:100%;max-height:220px;border-radius:12px;"><source src="${url}" type="${file.type}"></video>`;
    }
    const filename = `${Date.now()}_${file.name}`;
    const { data, error } = await sb.storage.from('posts-media').upload(filename, file);
    if(error){alert("Upload failed"); return;}
    preview.dataset.mediaUrl = data.path;
  }
  closePostMenu();
  openPostScreen("Media Upload");
}

// GIF
function openGif(){
  closePostMenu();
  document.getElementById("gif-panel").style.display="flex";
  openPostScreen("GIF");
}

// Emoji Panel
document.getElementById("emoji-btn").onclick=()=>{
  const panel=document.getElementById("emoji-panel");
  panel.style.display=panel.style.display==="flex"?"none":"flex";
  if(panel.style.display==="flex") loadEmojis();
}
function loadEmojis(){
  const panel=document.getElementById("emoji-panel");
  const emojis=["üòÑ","üòÇ","üòç","üî•","üíú","üëë‚ö°","üöÄüíú","üåçüî•","ü¶Å‚ú®"];
  panel.innerHTML=emojis.map(e=>`<button class="emoji-item">${e}</button>`).join("");
  panel.querySelectorAll(".emoji-item").forEach(btn=>{btn.onclick=()=>{document.getElementById("post-caption").value+=btn.innerText;}});
}

// Post Button
document.getElementById("post-btn").onclick=async()=>{
  const text=document.getElementById("post-caption").value;
  const mediaUrl=document.getElementById("media-preview").dataset.mediaUrl||null;
  if(!text.trim() && !mediaUrl){alert("Add text or media");return;}
  await sb.from("posts").insert([{username:myName,content:text||"",media_url:mediaUrl}]);
  document.getElementById("post-caption").value=""; document.getElementById("media-preview").innerHTML="Preview";
  document.getElementById("media-preview").dataset.mediaUrl="";
  closePostScreen();
  load();
  tg.HapticFeedback.notificationOccurred("success");
}

load();
</script>
</body>
    </html>
